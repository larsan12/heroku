<html>
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Task">
  <meta name="viewport" content="initial-scale=1.0, width=device-width">
  <title>Task</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"> </script>
  <link href="/style" rel="stylesheet" />
</head>
<body>
  <div class="main">

    <div class="TreeContainer left" >
      <ul class="tree">
      </ul>
    </div>

    <input id="move" onclick="move()" type="button" value="<<<">

    <div class="TreeContainer right" >
      <ul class="tree">
      </ul>
    </div>

    <input id="add" onclick="add()" type="button" value="+">
    <input id="delete" onclick="delete()" type="button" value="-">
    <input id="rename" onclick="rename()" type="button" value="a">
    <input id="apply" onclick="apply()" type="button" value="apply">
    <input id="reset" onclick="reset()" type="button" value="reset">
  </div>
  

  <script type="text/javascript">
    var session;
    var tree;
    var cash;

    function add() {
      $.ajax({
        type: "get",
        url: '/test',
        success: function(message){
          alert(message);
        }
      });
    };

    function drawNode(node) {
      if (node.parent) {
        var ctrl = $("#" + node.parent);
        if (ctrl.length) {
          if (ctrl.children("ul").length) {
            var nodeStr = "<li id=" + node.id +">";
            nodeStr += '<a style="margin-left:3px;" onclick="NodeSelection(this);">'+ 
            node.value + '</a>' + '</li>';
            ctrl.children("ul").append(nodeStr);
          } else {
            var nodeStr = "<ul> <li id=" + node.id +">";
            nodeStr += '<a style="margin-left:3px;" onclick="NodeSelection(this);">'+ 
            node.value + '</a>' + '</li> </ul>';
            ctrl.append(nodeStr);
          }
        }
      } else {
        var nodeStr = "<li id=" + node.id +">";
        nodeStr += '<a style="margin-left:3px;" onclick="NodeSelection(this);">'+ 
        node.value + '</a>' + '</li>';
        $(".right ul.tree").append(nodeStr);
      }
    }

    function drawTree(tree){
      if (tree.branches.length) {
        tree.branches.forEach(node => {
          drawNode(node);
        });
        tree.branches.forEach(node => {
          drawTree(node);
        });
      }
    }

    function NodeSelection(ctrl) {
      $('ul.tree li').find('a').each(function () { $(this).removeClass(); })
      $(ctrl).addClass("selected");
    }

    $(document).ready(function () {

      $.ajax({
        type: "get",
        dataType: 'json',
        url: '/session',
        success: function(res){
          session = res.id;
          tree = res.tree;
          drawNode(tree);
          drawTree(tree);
        }
      });

      $('ul.tree li a').click(function (e) {
        $('ul.tree li').find('a').each(function () { $(this).removeClass(); })

        $(this).addClass("selected");
      });
    });
  </script>
</body>
</html>